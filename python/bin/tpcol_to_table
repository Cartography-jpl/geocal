#! /usr/bin/env python
#
# This takes a pair of mars map images and co-registers the second
# image to the first.

import geocal

version = "June 24, 2019"
usage='''Usage:
  tpcol_to_table [options] <tpcol> <output_name>
  tpcol_to_table [options] <tpcol> <ref_image> <output_name>
  tpcol_to_table -h | --help
  tpcol_to_table -v | --version

Short utility to write a tie-point collection out in an ASCII table format.
You can either supply a reference image, or leave this off. If supplied, we
give the ground location both as longitude/latitude/height and as reference
image line/sample Without the reference image we leave off the reference line
and sample.

Options:
  -h --help         
       Print this message

  -v --version      
       Print program version
'''

# Mapping between long name and shorter vicar name
long_name_to_vicar = { "ref_image" : "refimg",
                       "output_name" : "out",
		       "tpcol": "tpcol" }

args = geocal.docopt_simple(usage, version=version,
                     long_name_to_vicar=long_name_to_vicar)

tpcol = geocal.read_shelve(args.tpcol)
if(args.ref_image):
    if(geocal.VicarLiteFile.is_vicar_file(args.ref_image)):
        ref_image = geocal.VicarLiteRasterImage(args.ref_image)
    else:
        ref_image = geocal.GdalRasterImage(args.ref_image)
else:
    ref_image = None
with open(args.output_name, "w") as fh:
    if(args.ref_image):
        print("# Reference image: %s" % args.ref_image, file=fh)
    print(tpcol.table_format(ref_image=ref_image), file=fh)
    
