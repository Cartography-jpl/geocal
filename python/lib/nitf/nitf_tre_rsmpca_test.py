from .nitf_tre import *
from .nitf_tre_rsmpca import *
from test_support import *
import io, six

def test_tre_rsmpca(rsm_rational_polynomial):
    t = TreRSMPCA()
    t.rsm_rational_polynomial = rsm_rational_polynomial
    t.update_raw_field()
    fh = six.BytesIO()
    t.write_to_file(fh)
    print(fh.getvalue())
    assert fh.getvalue() == b'RSMPCA05778                                                                                fake-1                                  001001                                          +2.88100000000000E+03+1.37630000000000E+04+7.84580476060708E-01+6.25886621258980E-01+1.01700000000000E+03+2.88100000000000E+03+1.37630000000000E+04+2.23255511469883E-03+3.70332146713892E-04+6.34000000000000E+02333064+1.03567227630782E-02-1.54384513357307E-01-3.11605198004854E-03+3.07104329409452E-05-1.16797126064005E+00+1.98352283749875E-03+2.65188091169478E-04+0.00000000000000E+00-8.15653784121847E-03+8.62824705219364E-04+0.00000000000000E+00+0.00000000000000E+00-7.60095251854148E-04+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-1.40866426332602E-02+3.73826197872560E-05-2.39690002775874E-06+0.00000000000000E+00-9.16381441103092E-05-1.45728169817972E-05+0.00000000000000E+00+0.00000000000000E+00+7.01406640420913E-05+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+3.14648629804308E-06-2.84622628436753E-05+0.00000000000000E+00+0.00000000000000E+00-2.11776244377282E-04+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-2.67604019819929E-06+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00333064+1.00000000000000E+00+4.03964136105717E-03-1.63806054382023E-04+3.10913913493809E-06+6.55137537836775E-03-7.67798515619684E-04+1.94418480619357E-05+0.00000000000000E+00+7.10397311134404E-04+2.07052236912434E-04+0.00000000000000E+00+0.00000000000000E+00+5.14117698966559E-04+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+4.94550218702910E-04+2.89678146845463E-05+6.40153017700561E-07+0.00000000000000E+00-6.96624462894180E-05+4.32710803304773E-06+0.00000000000000E+00+0.00000000000000E+00+1.89821482940099E-05+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+1.81976017778232E-04+9.25579060357458E-07+0.00000000000000E+00+0.00000000000000E+00-4.64416780855914E-07+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+1.97925094734606E-07+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00333064-1.27866184078077E-02+1.03542548980076E+00-4.45809238606574E-02-3.29855388426284E-02-2.38605228769734E-04-2.27862150998000E-02+1.27747921766858E-02+0.00000000000000E+00+6.06117741457993E-04-4.86012733531015E-02+0.00000000000000E+00+0.00000000000000E+00+8.27188555364750E-05+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-3.26941274350523E-02-7.41625301301184E-02-7.14173081803770E-04+0.00000000000000E+00+7.54912328262440E-04-6.38341565025359E-03+0.00000000000000E+00+0.00000000000000E+00+1.58610257072627E-03+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+2.57188822707622E-03-8.94960069149039E-03+0.00000000000000E+00+0.00000000000000E+00+2.05105096346050E-04+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+2.91518192941038E-04+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00333064+1.00000000000000E+00-5.52456088007039E-02-3.13403660415240E-02+3.74029429010512E-04-2.04579336611214E-02+1.24883529964864E-02-1.89250962090912E-04+0.00000000000000E+00-4.70094255604714E-02+5.72487406626278E-04+0.00000000000000E+00+0.00000000000000E+00-6.29035343073329E-05+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-7.42442295932643E-02-8.14738545578360E-04+5.53558265765439E-05+0.00000000000000E+00-5.85364310473969E-03+5.14222711617401E-05+0.00000000000000E+00+0.00000000000000E+00+4.82746709973058E-05+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-8.62015746808357E-03+1.04835423218860E-04+0.00000000000000E+00+0.00000000000000E+00-5.83401480397854E-06+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+1.03334284775194E-05+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00'
    
    fh2 = six.BytesIO(fh.getvalue())
    t2 = TreRSMPCA()
    t2.read_from_file(fh2)
    print(t2)
    # Check that we can't the field values.
    with pytest.raises(RuntimeError):
        t.iid = 'abc'
    with pytest.raises(RuntimeError):
        t.rnpcf[0] = 1.0

    assert t.iid is None
    assert t2.iid is None
    assert t.rsn == 1
    assert t2.rsn == 1
    assert t.csn == 1
    assert t2.csn == 1
    assert t.rfep is None
    assert t2.rfep is None
    assert t.cfep is None
    assert t2.cfep is None
    assert t.rnrmo == 2881.0
    assert t2.rnrmo == 2881.0
