#! /usr/bin/env python
from __future__ import print_function
try:
    from afids import *
except ImportError:
    from geocal import *
from geocal.nitf import *
import subprocess
import os
import sys

version="%prog March 8, 2017"
usage="""Usage: 
  nitfinfo [options] <input_file>
  nitfinfo -h | --help
  nitfinfo -v | --version

Print out information about a NITF file.

This use to be based on gdalinfo, but now we have our own NITF parser. I
don't think anything depends on the old format, but if so you can pass the
option --old-gdal to get the older output. We may retire this if it turns out
we never use it.

Options:
  -h --help         
       Print this message

  --old-gdal
       Use the old gdalinfo based version of this, if needed for backwards
       compatibility.

  -v --version      
       Print program version

"""
args = docopt_simple(usage, version=version)
if(args.old_gdal):
    t = subprocess.check_output(["gdalinfo", args.input_file])
    # Split string into before and after the "Corner Cordinates" section. Note
    # that it is perfectly ok for this to be missing, we just have t2 and t3 
    # as blank strings.
    t1, t2, t3 = t.partition("Corner Coordinates")

    f = GdalRasterImage(args.input_file)
    print(t1,end='')
    tre_use00a_pretty_print(f)
    # Function is only optionally available, depending on options
    # used at build time of AFIDS. If this isn't found then just
    # continue without complaint
    try:
        tre_afid_a_pretty_print(f)
    except NameError as exc:
        pass
    print(t2,end='')
    print(t3)
    sys.exit()
f = NitfFile(args.input_file)
print(f)
