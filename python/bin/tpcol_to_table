#! /usr/bin/env python
#
# This takes a pair of mars map images and co-registers the second
# image to the first.

import geocal
from tabulate import tabulate

version = "June 24, 2019"
usage='''Usage:
  tpcol_to_table [options] <tpcol> <output_name>
  tpcol_to_table [options] <tpcol> <ref_image> <output_name>
  tpcol_to_table -h | --help
  tpcol_to_table -v | --version

Short utility to write a tie-point collection out in an ASCII CSV table format.
You can either supply a reference image, or leave this off. If supplied, we
give the ground location both as longitude/latitude/height and as reference
image line/sample Without the reference image we leave off the reference line
and sample.

For larger tie-point collections, you can automatically generate the data
compressed by just adding a standard compression extension (e.g., foo.csv.bz2).
The extensions '.gz', '.bz2', '.zip' and '.xz' are supported.

Options:
  -h --help         
       Print this message

  -v --version      
       Print program version
'''

# Mapping between long name and shorter vicar name
long_name_to_vicar = { "ref_image" : "refimg",
                       "output_name" : "out",
		       "tpcol": "tpcol" }

args = geocal.docopt_simple(usage, version=version,
                     long_name_to_vicar=long_name_to_vicar)

tpcol = geocal.read_shelve(args.tpcol)
if(args.ref_image):
    if(geocal.VicarLiteFile.is_vicar_file(args.ref_image)):
        ref_image = geocal.VicarLiteRasterImage(args.ref_image)
    else:
        ref_image = geocal.GdalRasterImage(args.ref_image)
else:
    ref_image = None
df = tpcol.data_frame2(ref_image=ref_image)
df.to_csv(args.output_name,index=False)
    
