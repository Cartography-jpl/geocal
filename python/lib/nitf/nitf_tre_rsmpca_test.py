from .nitf_tre import *
from .nitf_tre_rsmpca import *
from test_support import *
import io, six

def test_tre_rsmpca(rsm_rational_polynomial):
    t = TreRSMPCA()
    t.rsm_rational_polynomial = rsm_rational_polynomial
    t.update_raw_field()
    fh = six.BytesIO()
    t.write_to_file(fh)
    assert fh.getvalue() == b'RSMPCA05778                                                                                fake-1                                  001001                                          +2.88100000000000E+03+1.37630000000000E+04+4.49534000000000E+01+3.58606000000000E+01+1.01700000000000E+03+2.92100000000000E+03+1.42380000000000E+04+1.23900000000000E-01+2.09000000000000E-02+6.34000000000000E+02333064+1.32748000000000E-02-1.47510000000000E-01-2.86551000000000E-03+7.88107000000000E-06-1.13465000000000E+00+2.00180000000000E-03-2.25421000000000E-05+0.00000000000000E+00-7.78726000000000E-03+3.65929000000000E-05+0.00000000000000E+00+0.00000000000000E+00-2.08933000000000E-05+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-1.38959000000000E-02+6.35242000000000E-05+3.63930000000000E-07+0.00000000000000E+00+1.15861000000000E-04-1.26487000000000E-06+0.00000000000000E+00+0.00000000000000E+00-9.39815000000000E-07+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+3.88308000000000E-06+2.32154000000000E-06+0.00000000000000E+00+0.00000000000000E+00+1.80910000000000E-05+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-4.31269000000000E-08+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00333064+1.00000000000000E+00+3.80256000000000E-03-1.92637000000000E-05+1.26794000000000E-06+6.43151000000000E-03+1.84958000000000E-05+2.46815000000000E-05+0.00000000000000E+00+7.22401000000000E-05+1.90771000000000E-04+0.00000000000000E+00+0.00000000000000E+00+4.91660000000000E-04+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+3.14790000000000E-04-1.98243000000000E-06+3.20900000000000E-07+0.00000000000000E+00-1.16422000000000E-06+4.95049000000000E-06+0.00000000000000E+00+0.00000000000000E+00+1.81401000000000E-05+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-1.61779000000000E-05-1.57429000000000E-07+0.00000000000000E+00+0.00000000000000E+00-5.41022000000000E-07+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+1.43592000000000E-07+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00333064-1.04025000000000E-02+9.68850000000000E-01+1.07384000000000E-02+1.06017000000000E-04-4.87887000000000E-04-7.10444000000000E-04+1.03307000000000E-05+0.00000000000000E+00-5.19453000000000E-06+5.41226000000000E-06+0.00000000000000E+00+0.00000000000000E+00+5.84016000000000E-05+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-3.25142000000000E-02+2.17572000000000E-04+9.01765000000000E-06+0.00000000000000E+00-6.54969000000000E-05-1.21058000000000E-06+0.00000000000000E+00+0.00000000000000E+00+1.65988000000000E-06+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-1.76761000000000E-05-3.89680000000000E-06+0.00000000000000E+00+0.00000000000000E+00+3.80777000000000E-08+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-1.19374000000000E-07+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00333064+1.00000000000000E+00-3.19831000000000E-04+4.76371000000000E-06-1.07213000000000E-06+6.81092000000000E-04-2.67977000000000E-06-1.69482000000000E-07+0.00000000000000E+00-1.47985000000000E-05+1.10590000000000E-07+0.00000000000000E+00+0.00000000000000E+00+1.08104000000000E-06+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-5.49762000000000E-04-6.19388000000000E-06-2.33038000000000E-07+0.00000000000000E+00+2.67975000000000E-08+1.44009000000000E-08+0.00000000000000E+00+0.00000000000000E+00+1.86413000000000E-08+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-4.23457000000000E-06+4.10217000000000E-08+0.00000000000000E+00+0.00000000000000E+00+1.00000000000000E-09+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00-1.35637000000000E-08+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00+0.00000000000000E+00'
    
    fh2 = six.BytesIO(fh.getvalue())
    t2 = TreRSMPCA()
    t2.read_from_file(fh2)
    print(t2)
    # Check that we can't the field values.
    with pytest.raises(RuntimeError):
        t.iid = 'abc'
    with pytest.raises(RuntimeError):
        t.rnpcf[0] = 1.0

    assert t.iid is None
    assert t2.iid is None
    assert t.rsn == 1
    assert t2.rsn == 1
    assert t.csn == 1
    assert t2.csn == 1
    assert t.rfep is None
    assert t2.rfep is None
    assert t.cfep is None
    assert t2.cfep is None
    assert t.rnrmo == 2881.0
    assert t2.rnrmo == 2881.0
